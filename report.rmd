---
title: "New York City Stop-Question-Frisk Analysis"
author: "Jacky Lee, Tyler Sam, Sam Tan, Julianne Lin"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_chunk$set(eval=TRUE)
knitr::opts_chunk$set(warning=FALSE)
knitr::opts_chunk$set(message=FALSE)
library(kernlab)
data(spam)
sqf2010 = read.csv("2010_sqf_m35.csv")
sqf2015 = read.csv("2015_sqf_m35.csv")
```

**The report should have the following structure:**

1. Introduction (overview in your own words of the data; summary of your team's chosen question, why it's important, and what you found; roadmap for the remainder of the report.)

2. Responses to required questions: Please list each question/answer separately, but write formal responses to the questions.

3. Analysis of your chosen questions: Be sure to describe your questions and why they are interesting/important, and provide suitable graphical and statistical analysis of the data to answer the questions.

4. Conclusions and Recommendations

5. Bibliography if you use any external sources

6. Appendices as necessary

**Your report will be evaluated based on the following criteria:**
- Writing: Structure of report; clarity of writing; quality of editing and polishing the document

- Correctness of methodology: Appropriate graphical and statistical techniques are used to answer the questions

- Validity of interpretation: The results are interpreted correctly

- Significance: The team-chosen question(s) leverage the available data to provide insight into the stop-question-frisk policy.

```{r}
#1.
testedHispanic = length(sqf2010$race[sqf2010$race=='WHITE-HISPANIC'])
testedAsian = length(sqf2010$race[sqf2010$race=='ASIAN/PACIFIC ISLANDER'])
trueHispanic = testedHispanic*19/18 - testedAsian/18
trueAsian = testedAsian*19/18 - testedHispanic/18
total = testedHispanic + testedAsian

probHispanic = trueHispanic / total
probAsian = trueAsian / total
probActualHispanic = 0.95*trueHispanic / testedHispanic
probActualAsian = 0.95*trueAsian / testedAsian
```

```{r}
#2.
friskedWhite <-sqf2010$frisked[sqf2010$race =="WHITE"]
friskedBlack <-sqf2010$frisked[sqf2010$race =="BLACK"]
friskedWhiteHispanic <-sqf2010$frisked[sqf2010$race =="WHITE-HISPANIC"]
friskedBlackHispanic <-sqf2010$frisked[sqf2010$race =="BLACK-HISPANIC"]
friskedAsianPI <-sqf2010$frisked[sqf2010$race =="ASIAN/PACIFIC ISLANDER"]
friskedNatAmer <- sqf2010$frisked[sqf2010$race == "AMERICAN INDIAN/ALASKAN NATIVE"]

t.test(x=friskedAsianPI, y = friskedNatAmer, conf.level = .95)
```

```{r}
#3.
agesM = subset(sqf2010, sqf2010$age>5&sqf2010$age<98&sqf2010$sex =="M")
agesF = subset(sqf2010, sqf2010$age>5&sqf2010$age<98&sqf2010$sex =="F")
qqnorm(agesM$age)
qqnorm(agesF$age)
# both subsets of the age appear normal
qqplot(agesM$age, agesF$age)
# since the qqplot is a line, the distributions are the same.

agesStop = sqf2010$age[sqf2010$age<98&sqf2010$age>5]
qqplot(agesM$age, agesStop)
# since the qqplot is a line, the distributions are the same.
```

```{r}
#4.
sample_size = 22563
# the sample size of the 2015 data set is 22563
sample_mean <- mean(sqf2015$frisked)
z_critical <- qnorm(0.975)
pop_stdev <- sd(sqf2015$frisked)
margin_of_error <- z_critical * (pop_stdev / sqrt(sample_size))
confidence_interval <- c(sample_mean - margin_of_error,
                         sample_mean + margin_of_error)
print("Confidence interval:")
confidence_interval

# Confidence Interval for 2015 rates for being frisked(0.6700898 0.6823013)

summary(sqf2015)
sample_size = 639
# the sample size of the 2015 data set is 22563
sample_noId = subset(sqf2015, sqf2015$typeofid =="REFUSED" )
sample_mean <- mean(sample_noId$frisked)
z_critical <- qnorm(0.975)
pop_stdev <- sd(sample_noId$frisked)
margin_of_error <- z_critical * (pop_stdev / sqrt(sample_size))
confidence_interval <- c(sample_mean - margin_of_error,
                         sample_mean + margin_of_error)
print("Confidence interval:")
confidence_interval
# Confidence Interval for 2015 rates for being frisked given that
# one refused to show ID(0.5724871 0.6481702)
```

```{r}
#5.
m_best = step(lm(formula = perstop ~ arstmade + searched + inside + sumissue + frisked + weap + contrabn + radio + pf, data = sqf2010[sqf2010$perstop<30,]))
plot(m_best$fitted.values, m_best$residuals)
qqplot(m_best$fitted.values, m_best$residuals)

# m_full = lm(complied ~ pop + hdi + dem + internet + freepress, data = goog_sub)
# m_best = step(m_full)
# plot(m_best$fitted.values, m_best$residuals)
```

Self-generated questions:

According to an analysis of the Stop and Frisk measure between 2002 and 2013 done by the New York Civil Liberties Union, young black and Latino men were stopped disproportionately by a huge margin. It claimed that:
(1) Black and Latino males between the ages of 14 and 24 accounted for 41 percent of stops between 2003 and 2013, even though they were only 4.7 of the total city population. (2) Furthermore, according to their analysis, 90 percent of young black and Latino men stopped were innocent.
Verify that these trends continued in the year 2015.
Link: http://www.nyclu.org/files/publications/stopandfrisk_briefer_2002-2013_final.pdf

'''{r}
# Question 1
ages1424BL= subset(sqf2015, sqf2015$age>13 & sqf2015$age<25 & (sqf2015$race =="BLACK" | sqf2015$race == "WHITE-HISPANIC" | sqf2015$race == "BLACK-HISPANIC"))
ages1424BLM = subset(ages1424BL, ages1424BL$sex == "M")
dim(ages1424BLM)
# the number of samples in sqf2015 given that one is male, black or hispanic, and between the ages 14 and 24 is 8749.
dim(sqf2015)
# the number of samples in sqf2015 is 22563
prop.test(8749, 22563, alternative = c("two.sided", "less", "greater"), conf.level = .95)
# the 95% confidence interval for this proportion is (.381, .394).
# Since .41 is not in our 95% confidence interval, we can conclude that the proportion of males who are black or latino between the ages 14 and 24 decreased in 2015 compared to the percentage in 2003 to 2013.


#Question 2
ages1424BLMI = subset(ages1424BLM, ages1424BL$arstmade == 0)
dim(ages1424BLMI)
# the number of samples in sqf2015 given that one is male, black or hispanic, between the ages 14 and 24, and innocent is 7761
dim(ages1424BLM)
# the number of samples in sqf2015 given that one is male, black or hispanic, and between the ages 14 and 24 is 8749.
prop.test(7761, 8749, alternative = c("two.sided", "less", "greater"), conf.level = .95)
# the 95% confidence interval for this proportion is (.880, .894).
# Since .9 is not in our 95% confidence interval, we can conclude that the proportion of males who are black or latino, between the ages 14 and 24, and innocent decreased in 2015 compared to the percentage in 2003 to 2013.
'''

According to this analysis of race and crime in Chicago, Black people are 85\% more likely than Whites to commit a violent crime compared to whites, while Latino people are 10\% less likely than Whites. Compare this data to the proportion of Black and Latino people who were stopped. (3)Does the data of sqf2015 support stopping blacks at higher rates compared to whites? (4)Does the data of sqf2015 support stopping latinos at lower rates compared?
Link: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1449156/
'''
# Question 3
blackArrest = subset(sqf2015, sqf2015$arstmade == 1 & sqf2015$race == "BLACK")
whiteArrest = subset(sqf2015,sqf2015$arstmade == 1 & sqf2015$race == "WHITE")

#proportion of blacks who were arrested out of all black individuals who were stopped by the police.
dim(blackArrest)
dim(subset(sqf2015, sqf2015$race == "BLACK"))

prop.test(1993, 11950, alternative = c("two.sided", "less", "greater"), conf.level = .95)
# the 95% confidence interval for this proportion is (.160, .174).

dim(whiteArrest)
dim(subset(sqf2015, sqf2015$race == "WHITE"))

prop.test(344, 2514, alternative = c("two.sided", "less", "greater"), conf.level = .95)
# the 95% confidence interval for this proportion is (.124, .151).
# Based on the results from the two proportion tests above, since the confidence intervals do not overlap, statistically speaking, it is justified for police to stop more blacks than whites. 

# Question 4
latinoArrest = subset(sqf2015, sqf2015$arstmade == 1 & (sqf2015$race == "BLACK-HISPANIC" | sqf2015$race == "WHITE-HISPANIC"))

#proportion of blacks who were arrested out of all black individuals who were stopped by the police.
dim(latinoArrest)
dim(subset(sqf2015, sqf2015$race == "BLACK-HISPANIC" | sqf2015$race == "WHITE-HISPANIC"))

prop.test(1423, 6499, alternative = c("two.sided", "less", "greater"), conf.level = .95)
# the 95% confidence interval for this proportion is (.209, .229).

dim(whiteArrest)
dim(subset(sqf2015, sqf2015$race == "WHITE"))

prop.test(344, 2514, alternative = c("two.sided", "less", "greater"), conf.level = .95)
# the 95% confidence interval for this proportion is (.124, .151).
# Based on the results from the two proportion tests above, since the confidence intervals do not overlap, statistically speaking, it is not justified for police to stop more whites than latinos. 
