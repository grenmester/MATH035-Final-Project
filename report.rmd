---
title: "New York City Stop-Question-Frisk Analysis"
author: "Jacky Lee, Tyler Sam, Sam Tan, Julianne Lin"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_chunk$set(eval=TRUE)
knitr::opts_chunk$set(warning=FALSE)
knitr::opts_chunk$set(message=FALSE)
library(kernlab)
data(spam)
sqf2010 = read.csv("2010_sqf_m35.csv")
sqf2015 = read.csv("2015_sqf_m35.csv")
```

**The report should have the following structure:**

1. Introduction (overview in your own words of the data; summary of your team's chosen question, why it's important, and what you found; roadmap for the remainder of the report.)

2. Responses to required questions: Please list each question/answer separately, but write formal responses to the questions.

3. Analysis of your chosen questions: Be sure to describe your questions and why they are interesting/important, and provide suitable graphical and statistical analysis of the data to answer the questions.

4. Conclusions and Recommendations

5. Bibliography if you use any external sources

6. Appendices as necessary

**Your report will be evaluated based on the following criteria:**
- Writing: Structure of report; clarity of writing; quality of editing and polishing the document

- Correctness of methodology: Appropriate graphical and statistical techniques are used to answer the questions

- Validity of interpretation: The results are interpreted correctly

- Significance: The team-chosen question(s) leverage the available data to provide insight into the stop-question-frisk policy.

(No Intro yet)

1. Determine the probability that someone who is identified by the officer as Hispanic is actually Hispanic and the probability that someone who is identified as Asian/Pacific Islander is actually API. What does this say about how we utilize the race column of the data?

The question asks for the conditional probability that you are actually a certain race given you are identified as that race, P(actual | tested) where tested implies identification. We are given the probability of correct identification. Thus, given the data from SQF2010, we are able to set up a system of equations to solve for the number of true Asians and true Hispanics (see code chunk #1 lines 53-54). We did this by adding the product of identified (tested) Asians and their respective probabilities and the product of identified Hispanics and their respective probabilities. The probabilities we used We then used this information to calculate the probability of being Asian/Hispanic given the identification (lines 59-60).

Primarily, we utilized the SQF2010 race column data in that we used it to find the number of identified Asians and the number of identified Hispanics. Knowing these numbers (testedHispanic line 51, and testedAsian line 52), allows us to find various probabilities because a lot of the calculations are based on the condition of having been identified as race x.

```{r}
#1.
testedHispanic = length(sqf2010$race[sqf2010$race=='WHITE-HISPANIC'])
testedAsian = length(sqf2010$race[sqf2010$race=='ASIAN/PACIFIC ISLANDER'])
trueHispanic = testedHispanic*19/18 - testedAsian/18
trueAsian = testedAsian*19/18 - testedHispanic/18
total = testedHispanic + testedAsian

probHispanic = trueHispanic / total
probAsian = trueAsian / total
probActualHispanic = 0.95*trueHispanic / testedHispanic
probActualAsian = 0.95*trueAsian / testedAsian
```

2. Compare the rates at which suspects stopped in 2010 were frisked, broken down by race. Are the differences in rates between the various groups statistically significant? Which borough(s) had the largest differences? The smallest?

```{r}
#2.
Q <- sqf2010$frisked[sqf2010$city=="QUEENS"]
B <- sqf2010$frisked[sqf2010$city==""]
x <- data.frame(data=c(Q,B,M,BX,SI),
                key=c(
                  rep('Queens', length(Q)),
                  rep('')))

friskedWhite <-sqf2010$frisked[sqf2010$race =="WHITE"]
friskedBlack <-sqf2010$frisked[sqf2010$race =="BLACK"]
friskedWhiteHispanic <-sqf2010$frisked[sqf2010$race =="WHITE-HISPANIC"]
friskedBlackHispanic <-sqf2010$frisked[sqf2010$race =="BLACK-HISPANIC"]
friskedAsianPI <-sqf2010$frisked[sqf2010$race =="ASIAN/PACIFIC ISLANDER"]
friskedNatAmer <- sqf2010$frisked[sqf2010$race == "AMERICAN INDIAN/ALASKAN NATIVE"]

t.test(x=friskedAsianPI, y = friskedNatAmer, conf.level = .95)
```

3. In this question, we analyzed the distribution of the ages of male suspects and female suspects individually and then compare them with each other. First, we took out extraneous data by creating subsets that exclude ages below 5 and above 98. To determine their individual distributions, we used qqnorm to check for normality and concluded that both male and female suspects' ages are distributed normally. To analyze both distributions in relation with each other, we used a qqplot with the subsets of the ages of male and female suspects. The qqplot appears to be linear, thus we concluded that the distributions are the same. Later, we analyzed the age distribution for male suspects in relation to the age distribution of the entire population of suspects stopped in 2010. Again, we created a subset of the population of stopped suspects by limitingthe age to between 5 and 98. We then compared using the qqplot command using the arguments of the male subset from earlier and the total populatio subset we created. Again, qqplot shows a linear relationship so we conclude the distributions are the same. In conclusion, both distributions of the ages of male and female suspects in 2010 are normally distributed. Both these age distributions are the same, and the the male age distribution and the total stopped suspect distribution are also the same.

```{r}
#3.
agesM = subset(sqf2010, sqf2010$age>5&sqf2010$age<98&sqf2010$sex =="M")
agesF = subset(sqf2010, sqf2010$age>5&sqf2010$age<98&sqf2010$sex =="F")
qqnorm(agesM$age)
qqnorm(agesF$age)
# both subsets of the age appear normal
qqplot(agesM$age, agesF$age)
# since the qqplot is a line, the distributions are the same.

agesStop = sqf2010$age[sqf2010$age<98&sqf2010$age>5]
qqplot(agesM$age, agesStop)
# since the qqplot is a line, the distributions are the same.
```

4. To analyze any differences between the probability of being frisked in general and the probability of being frisked when not providing identification, we first calculated the confidence intervals for both. To calculate the CI for the general sample of frisked suspects, we first found the sample size, mean, critical z-value, and standard deviation. Then using that information, we found the margin of error from the sample mean and used that to calculate the confidence interval. The interval for 2015 rate of being frisked is (0.6700898, 0.6823013). Thus we have 95% confidence that the probability of being frisked is between 0.67 and 0.68, roughly speaking. Similarly, we calculated the confidence interval of the sample of frisked suspects who didn't provide identification. In this case, our sample is the subset of 2015 suspects whose identification is listed as 'REFUSED'. Using the same process we found the CI of 95% confidence for the sample of 2015 frisked suspects who didn't provide ID. Our confidence interval came out as (0.5724871, 0.6481702). This means that the probability of being frisked having refused identification is between 0.57 and 0.65. In conclusion, these two samples have a significant difference in probability of being frisked. The confidence intervals don't overlap, which means that the the probability of anyone from the general population of being frisked is outside the 95% confidence interval of that of those who refused identification. Basically, we conclude from our data that we have significant enough data to say that in 2015 there is a smaller probability of being frisked when identification is refused.

```{r}
#4.
sample_size = 22563
# the sample size of the 2015 data set is 22563
sample_mean <- mean(sqf2015$frisked)
z_critical <- qnorm(0.975)
pop_stdev <- sd(sqf2015$frisked)
margin_of_error <- z_critical * (pop_stdev / sqrt(sample_size))
confidence_interval <- c(sample_mean - margin_of_error,
                         sample_mean + margin_of_error)
print("Confidence interval:")
confidence_interval

# Confidence Interval for 2015 rates for being frisked(0.6700898 0.6823013)

summary(sqf2015)
sample_size = 639
# the sample size of the 2015 data set is 22563
sample_noId = subset(sqf2015, sqf2015$typeofid =="REFUSED" )
sample_mean <- mean(sample_noId$frisked)
z_critical <- qnorm(0.975)
pop_stdev <- sd(sample_noId$frisked)
margin_of_error <- z_critical * (pop_stdev / sqrt(sample_size))
confidence_interval <- c(sample_mean - margin_of_error,
                         sample_mean + margin_of_error)
print("Confidence interval:")
confidence_interval
# Confidence Interval for 2015 rates for being frisked given that
# one refused to show ID(0.5724871 0.6481702)
```

5. 

```{r}
#5.
m_best = step(lm(formula = perstop ~ arstmade + searched + inside + sumissue + frisked + weap + contrabn + radio + pf, data = sqf2010[sqf2010$perstop<30,]))
plot(m_best$fitted.values, m_best$residuals)
qqplot(m_best$fitted.values, m_best$residuals)

# m_full = lm(complied ~ pop + hdi + dem + internet + freepress, data = goog_sub)
# m_best = step(m_full)
# plot(m_best$fitted.values, m_best$residuals)
```
